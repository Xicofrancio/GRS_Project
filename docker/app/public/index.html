<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Demo Backup App</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
      color: #333;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      border-radius: 8px;
      margin-top: 20px;
    }
    
    h1, h3 {
      color: #2c3e50;
      margin-bottom: 1rem;
    }
    
    .section {
      margin-bottom: 2rem;
      padding: 1rem;
      border: 1px solid #eee;
      border-radius: 4px;
    }
    
    .file-list {
      margin-top: 20px;
    }
    
    .file-item {
      padding: 10px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .file-item:hover {
      background-color: #f8f9fa;
    }
    
    .upload-form {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background-color: #0056b3;
    }
    
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    
    .upload-progress {
      display: none;
      margin-top: 10px;
    }
    
    .alert {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    
    .alert-success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .alert-error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .file-info {
      color: #666;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸŽ‰ Demo Full-Stack Environment</h1>
    <p>Test your backup and restore functionality!</p>
    
    <div class="section">
      <h3>Upload File</h3>
      <form id="uploadForm" class="upload-form">
        <input type="file" id="fileInput" required>
        <button type="submit" id="uploadButton">Upload</button>
      </form>
      <div id="uploadProgress" class="upload-progress"></div>
    </div>

    <div class="section file-list">
      <h3>Files in Storage</h3>
      <div id="filesList"></div>
    </div>

    <div class="section">
      <h3>API Health Check</h3>
      <button onclick="checkHealth()">Check Health</button>
      <div id="healthStatus"></div>
    </div>
  </div>

  <script>
    // Upload file
    document.getElementById('uploadForm').onsubmit = async (e) => {
      e.preventDefault()
      const formData = new FormData()
      const fileInput = document.getElementById('fileInput')
      const uploadButton = document.getElementById('uploadButton')
      const uploadProgress = document.getElementById('uploadProgress')
      
      if (!fileInput.files[0]) {
        showAlert('Please select a file', 'error')
        return
      }
      
      // Check file size (10MB limit)
      if (fileInput.files[0].size > 10 * 1024 * 1024) {
        showAlert('File too large. Maximum size is 10MB.', 'error')
        return
      }
      
      formData.append('file', fileInput.files[0])
      
      try {
        uploadButton.disabled = true
        uploadProgress.style.display = 'block'
        uploadProgress.textContent = 'Uploading...'
        
        const response = await fetch('/api/upload', {
          method: 'POST',
          body: formData
        })
        
        const result = await response.json()
        
        if (!response.ok) {
          throw new Error(result.error || 'Upload failed')
        }
        
        showAlert('File uploaded successfully!', 'success')
        fileInput.value = ''
        loadFiles()
      } catch (err) {
        showAlert(err.message || 'Upload failed', 'error')
        console.error(err)
      } finally {
        uploadButton.disabled = false
        uploadProgress.style.display = 'none'
      }
    }

    // List files
    async function loadFiles() {
      try {
        const response = await fetch('/api/files')
        const files = await response.json()
        const filesList = document.getElementById('filesList')
        
        if (!files.length) {
          filesList.innerHTML = '<div class="file-item">No files uploaded yet</div>'
          return
        }
        
        filesList.innerHTML = files.map(file => `
          <div class="file-item">
            <div>
              <strong>${file.name}</strong>
              <div class="file-info">
                Size: ${formatFileSize(file.size)} | 
                Type: ${file.type || 'Unknown'} | 
                Modified: ${new Date(file.lastModified).toLocaleString()}
              </div>
            </div>
          </div>
        `).join('')
      } catch (err) {
        console.error('Failed to load files:', err)
        showAlert('Failed to load files', 'error')
      }
    }

    // Health check
    async function checkHealth() {
      const healthStatus = document.getElementById('healthStatus')
      try {
        const response = await fetch('/api/health')
        const data = await response.json()
        showAlert(`API Status: ${data.status}`, 'success')
      } catch (err) {
        showAlert('Health check failed', 'error')
      }
    }

    // Utility functions
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes'
      const k = 1024
      const sizes = ['Bytes', 'KB', 'MB', 'GB']
      const i = Math.floor(Math.log(bytes) / Math.log(k))
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
    }

    function showAlert(message, type) {
      const alertDiv = document.createElement('div')
      alertDiv.className = `alert alert-${type}`
      alertDiv.textContent = message
      
      const container = document.querySelector('.container')
      container.insertBefore(alertDiv, container.firstChild)
      
      setTimeout(() => alertDiv.remove(), 5000)
    }

    // Load files on page load
    loadFiles()
  </script>
</body>
</html>
